@using OpsMax.DTO.ViewModels
@model IEnumerable<CollectionSummaryVM>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Collections Summary</h3>

    <a asp-action="Create" class="btn btn-success">
        <i class="bi bi-plus-circle"></i> New Collection
    </a>
</div>

<table class="table table-bordered table-hover table-sm">
    <thead class="table-dark">
        <tr>
            <th>Date</th>
            <th>Invoice #</th>
            <th>Customer</th>
            <th>Driver</th>
            <th class="text-end">Purchased</th>
            <th class="text-end">Collected</th>
            <th class="text-end">Under</th>
            <th class="text-end">Over</th>
            <th class="text-end">Invoice Total</th>
            <th>Status</th>
            <th>Attachment</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.DateCollected.ToString("yyyy-MM-dd")</td>
                <td>@item.InvoiceNumber</td>
                <td>@item.CustomerName</td>
                <td>@item.Driver</td>

                <td class="text-end">@item.TotalPurchased.ToString("N2")</td>
                <td class="text-end">@item.TotalCollected.ToString("N2")</td>

                <td class="text-end text-warning">
                    @item.UnderCollected.ToString("N2")
                </td>

                <td class="text-end text-danger">
                    @item.OverCollected.ToString("N2")
                </td>

                <td class="text-end fw-bold">
                    @item.InvoiceTotal.ToString("N2")
                </td>

                <td>
                    @(item.OrderStatusID == 3 ? "Completed" : "Open")
                </td>

                <td>
                    @if (!string.IsNullOrEmpty(item.AttachmentPath))
                    {
                        <a href="@item.AttachmentPath"
                           target="_blank"
                           class="btn btn-sm btn-outline-secondary">
                            View
                        </a>
                    }
                </td>

                <td>
                    <a asp-action="Details"
                       asp-route-id="@item.idOrderCollected"
                       class="btn btn-sm btn-primary">
                        Details
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>
