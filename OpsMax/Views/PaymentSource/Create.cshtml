@model OpsMax.DTO.ViewModels.PaymentSourceCreatePageVM

<form asp-action="Create"
      method="post"
      enctype="multipart/form-data">

    @Html.AntiForgeryToken()

    <!-- =========================
         HEADER DETAILS
    ========================= -->
    <div class="row mb-3">
        <div class="col-md-3">
            <label asp-for="Form.SourceType" class="form-label"></label>
            <select asp-for="Form.SourceType" class="form-select" id="sourceType">
                <option value="">-- Select Source --</option>
                <option value="AP">Accounts Payable</option>
                <option value="GL">General Ledger</option>
            </select>
            <span asp-validation-for="Form.SourceType" class="text-danger"></span>
        </div>

        <div class="col-md-3">
            <label asp-for="Form.AccountId" class="form-label"></label>
            <input asp-for="Form.AccountId" class="form-control" placeholder="Account ID" />
            <span asp-validation-for="Form.AccountId" class="text-danger"></span>
        </div>

        <div class="col-md-4">
            <label asp-for="Form.OrderReference" class="form-label"></label>
            <input asp-for="Form.OrderReference" class="form-control" placeholder="Order Reference" />
            <span asp-validation-for="Form.OrderReference" class="text-danger"></span>
        </div>
    </div>

    <hr />

    <!-- =========================
         AP SECTION
    ========================= -->
    <div id="apSection" style="display:none;">
        <div class="row mb-3">
            <div class="col-md-6">
                <label asp-for="Form.SupplierId" class="form-label"></label>
                <select asp-for="Form.SupplierId" class="form-select"
                        asp-items="@(new SelectList(Model.Suppliers, "SupplierId", "SupplierName"))">
                    <option value="">-- Select Supplier --</option>
                </select>
                <span asp-validation-for="Form.SupplierId" class="text-danger"></span>
            </div>

            <div class="col-md-6">
                <label asp-for="Form.GrvNumber" class="form-label"></label>
                <select asp-for="Form.GrvNumber" class="form-select">
                    <option value="">-- Select GRV --</option>
                    @foreach (var g in Model.Suppliers)
                    {
                        <option>@g.GrvNumber</option>
                    }
                </select>
                <span asp-validation-for="Form.GrvNumber" class="text-danger"></span>
            </div>
        </div>
    </div>

    <!-- =========================
         GL SECTION
    ========================= -->
    <div id="glSection" style="display:none;">
        <div class="row mb-3">
            <div class="col-md-6">
                <label asp-for="Form.GlAccountId" class="form-label"></label>
                <select asp-for="Form.GlAccountId" class="form-select"
                        asp-items="@(new SelectList(Model.GlAccounts, "GlAccountId", "AccountCode"))">
                    <option value="">-- Select GL Account --</option>
                </select>
                <span asp-validation-for="Form.GlAccountId" class="text-danger"></span>
            </div>

            <div class="col-md-6">
                <label asp-for="Form.Reference" class="form-label"></label>
                <input asp-for="Form.Reference" class="form-control" placeholder="Enter reference" />
                <span asp-validation-for="Form.Reference" class="text-danger"></span>
            </div>
        </div>
    </div>

    <hr />

    <!-- =========================
         SUPPORTING DOCUMENTS
    ========================= -->
    <h5>Supporting Documents</h5>
    <table class="table table-bordered" id="docTable">
        <thead>
            <tr>
                <th style="width:40%">Document Type</th>
                <th style="width:45%">File</th>
                <th style="width:15%"></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <input name="DocumentTypes[0]" class="form-control" placeholder="Invoice / POD / GRV" />
                </td>
                <td>
                    <input type="file" name="Files[0]" class="form-control" />
                </td>
                <td></td>
            </tr>
        </tbody>
    </table>

    <button type="button" class="btn btn-sm btn-secondary" onclick="addDoc()">+ Add Another Document</button>
    <br /><br />

    <button type="submit" class="btn btn-primary">Save Payment Source</button>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Toggle AP/GL sections
        const sourceSelect = document.getElementById("sourceType");
        const apSection = document.getElementById("apSection");
        const glSection = document.getElementById("glSection");

        function toggleSections() {
            const val = sourceSelect.value;
            apSection.style.display = val === "AP" ? "block" : "none";
            glSection.style.display = val === "GL" ? "block" : "none";
        }

        sourceSelect.addEventListener("change", toggleSections);
        document.addEventListener("DOMContentLoaded", toggleSections);

        // Supporting documents dynamic rows
        let docIndex = 1;
        function addDoc() {
            const row = `
                <tr>
                    <td>
                        <input name="DocumentTypes[${docIndex}]" class="form-control" placeholder="Invoice / POD / GRV" />
                    </td>
                    <td>
                        <input type="file" name="Files[${docIndex}]" class="form-control" />
                    </td>
                    <td>
                        <button type="button" class="btn btn-sm btn-danger" onclick="this.closest('tr').remove()">X</button>
                    </td>
                </tr>`;
            document.querySelector("#docTable tbody").insertAdjacentHTML("beforeend", row);
            docIndex++;
        }
    </script>
}
